; generated by ARM C/C++ Compiler, 4.1 [Build 481]
; commandline ArmCC [--c99 --split_sections --debug -c --asm --interleave -o.\Flash\Obj\hmc5883.o --depend=.\Flash\Obj\hmc5883.d --cpu=Cortex-M3 --apcs=interwork -O0 -I..\..\Libraries\CMSIS\CM3\CoreSupport -I..\..\Libraries\CMSIS\CM3\DeviceSupport\ST\STM32F10x -I..\..\Libraries\STM32F10x_StdPeriph_Driver\inc -I..\..\Libraries\STM32_USB-FS-Device_Driver\inc -I..\..\User\usb_virture_com -I..\..\User -I..\..\User\bsp -I..\..\User\Driver\IIC -I..\..\User\Driver\LED -I..\..\User\Driver\TIM -I..\..\User\Driver\SPI -I..\..\User\Driver\ADC -I..\..\User\Driver\Delay -I..\..\User\Driver\UART -I..\..\User\Driver\MOTOR -I..\..\User\Driver\PWM_IN -I..\..\User\Driver\EEPROM -I..\..\User\Modules\Modules_mpu6050 -I..\..\User\Modules\Modules_nrf24L01 -I..\..\User\Modules\Modules_hmc5883 -I..\..\User\Algorithm\Algorithm_filter -I..\..\User\Algorithm\Algorithm_math -I..\..\User\Algorithm\Algorithm_sqLite -I..\..\User\Algorithm\Algorithm_quaternion -I..\..\User\Function\MultiRotor_rc -I..\..\User\Function\MultiRotor_app -I..\..\User\Function\MultiRotor_ahrs -I..\..\User\Function\MultiRotor_radio -I..\..\User\Function\MultiRotor_control -I..\..\User\Modules\Modules_oled -I..\..\User\Driver\STMFLASH -I..\..\User\Modules\Modules_ms5611 -I..\..\User\Modules\Modules_ultrasonic -I..\..\User\sys -ID:\KEIL\KEIL_Pro\keil安装\ARM\INC -ID:\KEIL\KEIL_Pro\keil安装\ARM\INC\ST\STM32F10x -D__MICROLIB -DSTM32F10X_HD -DUSE_STDPERIPH_DRIVER --omf_browse=.\Flash\Obj\hmc5883.crf ..\..\User\Modules\Modules_hmc5883\hmc5883.c]
                          THUMB

                          AREA ||i.HMC5883lRead||, CODE, READONLY, ALIGN=2

                  HMC5883lRead PROC
;;;52     /*====================================================================================================*/
;;;53     void HMC5883lRead(int16_t *magData)
000000  e92d41ff          PUSH     {r0-r8,lr}
;;;54     {
000004  4605              MOV      r5,r0
;;;55     	u8 buf[6],cy,con=0;
000006  2600              MOVS     r6,#0
;;;56     	int16_t mag[3];
;;;57     	static u8 onc=1;
;;;58     	static int32_t An[3] = {0,0,0};
;;;59     	
;;;60     	// 读取寄存器数据
;;;61     	I2C_Read(MAG_ADDRESS, MAG_DATA_REGISTER, 6, buf);
000008  ab02              ADD      r3,sp,#8
00000a  2206              MOVS     r2,#6
00000c  2103              MOVS     r1,#3
00000e  203c              MOVS     r0,#0x3c
000010  f7fffffe          BL       I2C_Read
;;;62     
;;;63     	// 十位深度滤波
;;;64     	An[0] -= An[0]/10;
000014  4854              LDR      r0,|L1.360|
000016  6800              LDR      r0,[r0,#0]  ; An
000018  210a              MOVS     r1,#0xa
00001a  fb90f0f1          SDIV     r0,r0,r1
00001e  4952              LDR      r1,|L1.360|
000020  6809              LDR      r1,[r1,#0]  ; An
000022  1a08              SUBS     r0,r1,r0
000024  4950              LDR      r1,|L1.360|
000026  6008              STR      r0,[r1,#0]  ; An
;;;65     	An[0] += (int16_t)(buf[0] << 8 | buf[1]);
000028  f89d0009          LDRB     r0,[sp,#9]
00002c  f89d1008          LDRB     r1,[sp,#8]
000030  ea402001          ORR      r0,r0,r1,LSL #8
000034  b200              SXTH     r0,r0
000036  494c              LDR      r1,|L1.360|
000038  6809              LDR      r1,[r1,#0]  ; An
00003a  4408              ADD      r0,r0,r1
00003c  494a              LDR      r1,|L1.360|
00003e  6008              STR      r0,[r1,#0]  ; An
;;;66     	mag[0] = An[0]/10;
000040  4608              MOV      r0,r1
000042  6800              LDR      r0,[r0,#0]  ; An
000044  210a              MOVS     r1,#0xa
000046  fb90f0f1          SDIV     r0,r0,r1
00004a  b200              SXTH     r0,r0
00004c  f8ad0000          STRH     r0,[sp,#0]
;;;67     	
;;;68     	An[1] -= An[1]/10;
000050  4845              LDR      r0,|L1.360|
000052  6840              LDR      r0,[r0,#4]  ; An
000054  fb90f0f1          SDIV     r0,r0,r1
000058  4943              LDR      r1,|L1.360|
00005a  6849              LDR      r1,[r1,#4]  ; An
00005c  1a08              SUBS     r0,r1,r0
00005e  4942              LDR      r1,|L1.360|
000060  6048              STR      r0,[r1,#4]  ; An
;;;69     	An[1] += (int16_t)(buf[4] << 8 | buf[5]);
000062  f89d000d          LDRB     r0,[sp,#0xd]
000066  f89d100c          LDRB     r1,[sp,#0xc]
00006a  ea402001          ORR      r0,r0,r1,LSL #8
00006e  b200              SXTH     r0,r0
000070  493d              LDR      r1,|L1.360|
000072  6849              LDR      r1,[r1,#4]  ; An
000074  4408              ADD      r0,r0,r1
000076  493c              LDR      r1,|L1.360|
000078  6048              STR      r0,[r1,#4]  ; An
;;;70     	mag[1] = An[1]/10;
00007a  4608              MOV      r0,r1
00007c  6840              LDR      r0,[r0,#4]  ; An
00007e  210a              MOVS     r1,#0xa
000080  fb90f0f1          SDIV     r0,r0,r1
000084  b200              SXTH     r0,r0
000086  f8ad0002          STRH     r0,[sp,#2]
;;;71     	
;;;72     	An[2] -= An[2]/10;
00008a  4837              LDR      r0,|L1.360|
00008c  6880              LDR      r0,[r0,#8]  ; An
00008e  fb90f0f1          SDIV     r0,r0,r1
000092  4935              LDR      r1,|L1.360|
000094  6889              LDR      r1,[r1,#8]  ; An
000096  1a08              SUBS     r0,r1,r0
000098  4933              LDR      r1,|L1.360|
00009a  6088              STR      r0,[r1,#8]  ; An
;;;73     	An[2] += (int16_t)(buf[2] << 8 | buf[3]);
00009c  f89d000b          LDRB     r0,[sp,#0xb]
0000a0  f89d100a          LDRB     r1,[sp,#0xa]
0000a4  ea402001          ORR      r0,r0,r1,LSL #8
0000a8  b200              SXTH     r0,r0
0000aa  492f              LDR      r1,|L1.360|
0000ac  6889              LDR      r1,[r1,#8]  ; An
0000ae  4408              ADD      r0,r0,r1
0000b0  492d              LDR      r1,|L1.360|
0000b2  6088              STR      r0,[r1,#8]  ; An
;;;74     	mag[2] = An[2]/10;
0000b4  4608              MOV      r0,r1
0000b6  6880              LDR      r0,[r0,#8]  ; An
0000b8  210a              MOVS     r1,#0xa
0000ba  fb90f0f1          SDIV     r0,r0,r1
0000be  b200              SXTH     r0,r0
0000c0  f8ad0004          STRH     r0,[sp,#4]
;;;75     
;;;76     	//需要校准
;;;77     	if(flag.calibratingM) {
0000c4  4829              LDR      r0,|L1.364|
0000c6  7980              LDRB     r0,[r0,#6]  ; flag
0000c8  b140              CBZ      r0,|L1.220|
;;;78     		onc=1;
0000ca  2001              MOVS     r0,#1
0000cc  4928              LDR      r1,|L1.368|
0000ce  7008              STRB     r0,[r1,#0]
;;;79     		flag.MagIssue = 0;
0000d0  2000              MOVS     r0,#0
0000d2  4926              LDR      r1,|L1.364|
0000d4  70c8              STRB     r0,[r1,#3]
;;;80     		Mag_Calibration(mag);
0000d6  4668              MOV      r0,sp
0000d8  f7fffffe          BL       Mag_Calibration
                  |L1.220|
;;;81     	}
;;;82      
;;;83     	if(onc){
0000dc  4824              LDR      r0,|L1.368|
0000de  7800              LDRB     r0,[r0,#0]  ; onc
0000e0  b308              CBZ      r0,|L1.294|
;;;84     		onc=0;
0000e2  2000              MOVS     r0,#0
0000e4  4922              LDR      r1,|L1.368|
0000e6  7008              STRB     r0,[r1,#0]
;;;85     		
;;;86     		// 三个轴的最值都偏小 说明地磁有问题，停用地磁  
;;;87     		for(cy=0;cy<6;cy++)	{
0000e8  2400              MOVS     r4,#0
0000ea  e015              B        |L1.280|
                  |L1.236|
;;;88     			if(absu16(*(mag_limt+cy))<20)	con++;
0000ec  4821              LDR      r0,|L1.372|
0000ee  6800              LDR      r0,[r0,#0]  ; mag_limt
0000f0  f9300014          LDRSH    r0,[r0,r4,LSL #1]
0000f4  2800              CMP      r0,#0
0000f6  da05              BGE      |L1.260|
0000f8  481e              LDR      r0,|L1.372|
0000fa  6800              LDR      r0,[r0,#0]  ; mag_limt
0000fc  f9300014          LDRSH    r0,[r0,r4,LSL #1]
000100  4240              RSBS     r0,r0,#0
000102  e003              B        |L1.268|
                  |L1.260|
000104  481b              LDR      r0,|L1.372|
000106  6800              LDR      r0,[r0,#0]  ; mag_limt
000108  f9300014          LDRSH    r0,[r0,r4,LSL #1]
                  |L1.268|
00010c  2814              CMP      r0,#0x14
00010e  da01              BGE      |L1.276|
000110  1c70              ADDS     r0,r6,#1
000112  b2c6              UXTB     r6,r0
                  |L1.276|
000114  1c60              ADDS     r0,r4,#1              ;87
000116  b2c4              UXTB     r4,r0                 ;87
                  |L1.280|
000118  2c06              CMP      r4,#6                 ;87
00011a  dbe7              BLT      |L1.236|
;;;89     		}
;;;90     		if(con>=2) flag.MagIssue = 1;
00011c  2e02              CMP      r6,#2
00011e  db02              BLT      |L1.294|
000120  2001              MOVS     r0,#1
000122  4912              LDR      r1,|L1.364|
000124  70c8              STRB     r0,[r1,#3]
                  |L1.294|
;;;91       }
;;;92     	
;;;93     	// 修正
;;;94     	for(cy=0;cy<3;cy++)
000126  2400              MOVS     r4,#0
000128  e01a              B        |L1.352|
                  |L1.298|
;;;95     		*(magData+cy) = (fp32)(mag[cy] -(*(mag_limt+cy+3) + *(mag_limt+cy))/2);
00012a  4912              LDR      r1,|L1.372|
00012c  6809              LDR      r1,[r1,#0]  ; mag_limt
00012e  eb010144          ADD      r1,r1,r4,LSL #1
000132  f9b11006          LDRSH    r1,[r1,#6]
000136  4a0f              LDR      r2,|L1.372|
000138  6812              LDR      r2,[r2,#0]  ; mag_limt
00013a  f9322014          LDRSH    r2,[r2,r4,LSL #1]
00013e  188f              ADDS     r7,r1,r2
000140  eb0771d7          ADD      r1,r7,r7,LSR #31
000144  f93d2014          LDRSH    r2,[sp,r4,LSL #1]
000148  eba20061          SUB      r0,r2,r1,ASR #1
00014c  f7fffffe          BL       __aeabi_i2f
000150  4680              MOV      r8,r0
000152  f7fffffe          BL       __aeabi_f2iz
000156  b200              SXTH     r0,r0
000158  f8250014          STRH     r0,[r5,r4,LSL #1]
00015c  1c60              ADDS     r0,r4,#1              ;94
00015e  b2c4              UXTB     r4,r0                 ;94
                  |L1.352|
000160  2c03              CMP      r4,#3                 ;94
000162  dbe2              BLT      |L1.298|
;;;96     }
000164  e8bd81ff          POP      {r0-r8,pc}
;;;97     
                          ENDP

                  |L1.360|
                          DCD      ||An||
                  |L1.364|
                          DCD      flag
                  |L1.368|
                          DCD      onc
                  |L1.372|
                          DCD      mag_limt

                          AREA ||i.Init_HMC5883L||, CODE, READONLY, ALIGN=1

                  Init_HMC5883L PROC
;;;25     /*====================================================================================================*/
;;;26     u8 Init_HMC5883L(void)
000000  b510              PUSH     {r4,lr}
;;;27     {
;;;28     	u8 ack; 
;;;29     	
;;;30     	ack = Single_Read(MAG_ADDRESS, 0x0A);
000002  210a              MOVS     r1,#0xa
000004  203c              MOVS     r0,#0x3c
000006  f7fffffe          BL       Single_Read
00000a  4604              MOV      r4,r0
;;;31     	
;;;32     	if (!ack)
00000c  b90c              CBNZ     r4,|L2.18|
;;;33     			return FALSE;
00000e  2000              MOVS     r0,#0
                  |L2.16|
;;;34     
;;;35     	// leave test mode
;;;36     	Single_Write(MAG_ADDRESS, HMC58X3_R_CONFA, 0x70);   // Configuration Register A  -- 0 11 100 00  num samples: 8 ; output rate: 15Hz ; normal measurement mode
;;;37     	Single_Write(MAG_ADDRESS, HMC58X3_R_CONFB, 0x20);   // Configuration Register B  -- 001 00000    configuration gain 1.3Ga
;;;38     	Single_Write(MAG_ADDRESS, HMC58X3_R_MODE, 0x00);    // Mode register             -- 000000 00    continuous Conversion Mode
;;;39     	delay(100);
;;;40     
;;;41     	return TRUE;	 
;;;42     }
000010  bd10              POP      {r4,pc}
                  |L2.18|
000012  2270              MOVS     r2,#0x70              ;36
000014  2100              MOVS     r1,#0                 ;36
000016  203c              MOVS     r0,#0x3c              ;36
000018  f7fffffe          BL       Single_Write
00001c  2220              MOVS     r2,#0x20              ;37
00001e  2101              MOVS     r1,#1                 ;37
000020  203c              MOVS     r0,#0x3c              ;37
000022  f7fffffe          BL       Single_Write
000026  2200              MOVS     r2,#0                 ;38
000028  2102              MOVS     r1,#2                 ;38
00002a  203c              MOVS     r0,#0x3c              ;38
00002c  f7fffffe          BL       Single_Write
000030  2064              MOVS     r0,#0x64              ;39
000032  f7fffffe          BL       delay
000036  2001              MOVS     r0,#1                 ;41
000038  e7ea              B        |L2.16|
;;;43     	
                          ENDP


                          AREA ||i.Mag_Calibration||, CODE, READONLY, ALIGN=2

                  Mag_Calibration PROC
;;;106    /*====================================================================================================*/
;;;107    void Mag_Calibration(int16_t *array)
000000  e92d5fff          PUSH     {r0-r12,lr}
;;;108    {
000004  4607              MOV      r7,r0
;;;109    	u8 cy;
;;;110    	static u8  clen_flag=1; 
;;;111    	static fp32 x,y,z; 
;;;112    	
;;;113    	//校准之前先把之前数据清零
;;;114    	if(clen_flag){
000006  4894              LDR      r0,|L3.600|
000008  7800              LDRB     r0,[r0,#0]  ; clen_flag
00000a  b198              CBZ      r0,|L3.52|
;;;115    		clen_flag = 0;
00000c  2000              MOVS     r0,#0
00000e  4992              LDR      r1,|L3.600|
000010  7008              STRB     r0,[r1,#0]
;;;116    		x=y=z=0;
000012  4992              LDR      r1,|L3.604|
000014  6008              STR      r0,[r1,#0]  ; z
000016  4992              LDR      r1,|L3.608|
000018  6008              STR      r0,[r1,#0]  ; y
00001a  4992              LDR      r1,|L3.612|
00001c  6008              STR      r0,[r1,#0]  ; x
;;;117    		for(cy=0;cy<6;cy++)
00001e  2600              MOVS     r6,#0
000020  e006              B        |L3.48|
                  |L3.34|
;;;118    			*(mag_limt+cy)=0;
000022  2000              MOVS     r0,#0
000024  4990              LDR      r1,|L3.616|
000026  6809              LDR      r1,[r1,#0]  ; mag_limt
000028  f8210016          STRH     r0,[r1,r6,LSL #1]
00002c  1c70              ADDS     r0,r6,#1              ;117
00002e  b2c6              UXTB     r6,r0                 ;117
                  |L3.48|
000030  2e06              CMP      r6,#6                 ;117
000032  dbf6              BLT      |L3.34|
                  |L3.52|
;;;119    	}
;;;120      
;;;121    	// 开始采集 寻找三个轴的最大和最小值
;;;122    	for(cy=0;cy<3;cy++){
000034  2600              MOVS     r6,#0
000036  e021              B        |L3.124|
                  |L3.56|
;;;123    		if(*(mag_limt+cy)> *(array+cy)) *(mag_limt+cy) = *(array+cy);  //找最小
000038  488b              LDR      r0,|L3.616|
00003a  6800              LDR      r0,[r0,#0]  ; mag_limt
00003c  f9300016          LDRSH    r0,[r0,r6,LSL #1]
000040  f9371016          LDRSH    r1,[r7,r6,LSL #1]
000044  4288              CMP      r0,r1
000046  dd06              BLE      |L3.86|
000048  f8370016          LDRH     r0,[r7,r6,LSL #1]
00004c  4986              LDR      r1,|L3.616|
00004e  6809              LDR      r1,[r1,#0]  ; mag_limt
000050  f8210016          STRH     r0,[r1,r6,LSL #1]
000054  e010              B        |L3.120|
                  |L3.86|
;;;124    
;;;125    		else if(*(mag_limt+cy+3)<*(array+cy)) *(mag_limt+cy+3) = *(array+cy);  //找最大
000056  4884              LDR      r0,|L3.616|
000058  6800              LDR      r0,[r0,#0]  ; mag_limt
00005a  eb000046          ADD      r0,r0,r6,LSL #1
00005e  f9b00006          LDRSH    r0,[r0,#6]
000062  f9371016          LDRSH    r1,[r7,r6,LSL #1]
000066  4288              CMP      r0,r1
000068  da06              BGE      |L3.120|
00006a  f8370016          LDRH     r0,[r7,r6,LSL #1]
00006e  497e              LDR      r1,|L3.616|
000070  6809              LDR      r1,[r1,#0]  ; mag_limt
000072  eb010146          ADD      r1,r1,r6,LSL #1
000076  80c8              STRH     r0,[r1,#6]
                  |L3.120|
000078  1c70              ADDS     r0,r6,#1              ;122
00007a  b2c6              UXTB     r6,r0                 ;122
                  |L3.124|
00007c  2e03              CMP      r6,#3                 ;122
00007e  dbdb              BLT      |L3.56|
;;;126    	}
;;;127    	
;;;128    	if(flag.calibratingM == 1 && (absu16(sensor.acc.averag.z) > 5000))   {
000080  487a              LDR      r0,|L3.620|
000082  7980              LDRB     r0,[r0,#6]  ; flag
000084  2801              CMP      r0,#1
000086  d147              BNE      |L3.280|
000088  4979              LDR      r1,|L3.624|
00008a  6908              LDR      r0,[r1,#0x10]
00008c  2100              MOVS     r1,#0
00008e  f7fffffe          BL       __aeabi_cfcmple
000092  d204              BCS      |L3.158|
000094  4876              LDR      r0,|L3.624|
000096  6900              LDR      r0,[r0,#0x10]
000098  f0804000          EOR      r0,r0,#0x80000000
00009c  e001              B        |L3.162|
                  |L3.158|
00009e  4874              LDR      r0,|L3.624|
0000a0  6900              LDR      r0,[r0,#0x10]
                  |L3.162|
0000a2  4604              MOV      r4,r0
0000a4  4973              LDR      r1,|L3.628|
0000a6  f7fffffe          BL       __aeabi_cfrcmple
0000aa  d235              BCS      |L3.280|
;;;129    	  z += sensor.gyro.radian.z * Gyro_G * 0.002f;
0000ac  4970              LDR      r1,|L3.624|
0000ae  6e48              LDR      r0,[r1,#0x64]
0000b0  f7fffffe          BL       __aeabi_f2d
0000b4  4a70              LDR      r2,|L3.632|
0000b6  4b71              LDR      r3,|L3.636|
0000b8  e9cd0100          STRD     r0,r1,[sp,#0]
0000bc  f7fffffe          BL       __aeabi_dmul
0000c0  4680              MOV      r8,r0
0000c2  f04f4260          MOV      r2,#0xe0000000
0000c6  4b6e              LDR      r3,|L3.640|
0000c8  f7fffffe          BL       __aeabi_dmul
0000cc  4604              MOV      r4,r0
0000ce  460d              MOV      r5,r1
0000d0  4862              LDR      r0,|L3.604|
0000d2  6800              LDR      r0,[r0,#0]  ; z
0000d4  f7fffffe          BL       __aeabi_f2d
0000d8  4682              MOV      r10,r0
0000da  4622              MOV      r2,r4
0000dc  462b              MOV      r3,r5
0000de  f7fffffe          BL       __aeabi_dadd
0000e2  e9cd0102          STRD     r0,r1,[sp,#8]
0000e6  f7fffffe          BL       __aeabi_d2f
0000ea  495c              LDR      r1,|L3.604|
0000ec  6008              STR      r0,[r1,#0]  ; z
;;;130    		if(absFloat(z)>360)  flag.calibratingM = 2;
0000ee  2100              MOVS     r1,#0
0000f0  485a              LDR      r0,|L3.604|
0000f2  6800              LDR      r0,[r0,#0]  ; z
0000f4  f7fffffe          BL       __aeabi_cfcmple
0000f8  d204              BCS      |L3.260|
0000fa  4858              LDR      r0,|L3.604|
0000fc  6800              LDR      r0,[r0,#0]  ; z
0000fe  f0804000          EOR      r0,r0,#0x80000000
000102  e001              B        |L3.264|
                  |L3.260|
000104  4855              LDR      r0,|L3.604|
000106  6800              LDR      r0,[r0,#0]  ; z
                  |L3.264|
000108  4604              MOV      r4,r0
00010a  495e              LDR      r1,|L3.644|
00010c  f7fffffe          BL       __aeabi_cfrcmple
000110  d202              BCS      |L3.280|
000112  2002              MOVS     r0,#2
000114  4955              LDR      r1,|L3.620|
000116  7188              STRB     r0,[r1,#6]
                  |L3.280|
;;;131    	}
;;;132    	
;;;133    	if(flag.calibratingM == 2 && (absu16(sensor.acc.averag.x) > 5000))   {
000118  4854              LDR      r0,|L3.620|
00011a  7980              LDRB     r0,[r0,#6]  ; flag
00011c  2802              CMP      r0,#2
00011e  d147              BNE      |L3.432|
000120  4953              LDR      r1,|L3.624|
000122  6888              LDR      r0,[r1,#8]  ; sensor
000124  2100              MOVS     r1,#0
000126  f7fffffe          BL       __aeabi_cfcmple
00012a  d204              BCS      |L3.310|
00012c  4850              LDR      r0,|L3.624|
00012e  6880              LDR      r0,[r0,#8]  ; sensor
000130  f0804000          EOR      r0,r0,#0x80000000
000134  e001              B        |L3.314|
                  |L3.310|
000136  484e              LDR      r0,|L3.624|
000138  6880              LDR      r0,[r0,#8]  ; sensor
                  |L3.314|
00013a  4604              MOV      r4,r0
00013c  494d              LDR      r1,|L3.628|
00013e  f7fffffe          BL       __aeabi_cfrcmple
000142  d235              BCS      |L3.432|
;;;134    	  x += sensor.gyro.radian.x * Gyro_G * 0.002f;
000144  494a              LDR      r1,|L3.624|
000146  6dc8              LDR      r0,[r1,#0x5c]
000148  f7fffffe          BL       __aeabi_f2d
00014c  4604              MOV      r4,r0
00014e  4a4a              LDR      r2,|L3.632|
000150  4b4a              LDR      r3,|L3.636|
000152  f7fffffe          BL       __aeabi_dmul
000156  4680              MOV      r8,r0
000158  f04f4260          MOV      r2,#0xe0000000
00015c  4b48              LDR      r3,|L3.640|
00015e  f7fffffe          BL       __aeabi_dmul
000162  4682              MOV      r10,r0
000164  468b              MOV      r11,r1
000166  483f              LDR      r0,|L3.612|
000168  6800              LDR      r0,[r0,#0]  ; x
00016a  f7fffffe          BL       __aeabi_f2d
00016e  4652              MOV      r2,r10
000170  465b              MOV      r3,r11
000172  e9cd0100          STRD     r0,r1,[sp,#0]
000176  f7fffffe          BL       __aeabi_dadd
00017a  e9cd0102          STRD     r0,r1,[sp,#8]
00017e  f7fffffe          BL       __aeabi_d2f
000182  4938              LDR      r1,|L3.612|
000184  6008              STR      r0,[r1,#0]  ; x
;;;135    		if(absFloat(x)>360)  flag.calibratingM = 3;
000186  2100              MOVS     r1,#0
000188  4836              LDR      r0,|L3.612|
00018a  6800              LDR      r0,[r0,#0]  ; x
00018c  f7fffffe          BL       __aeabi_cfcmple
000190  d204              BCS      |L3.412|
000192  4834              LDR      r0,|L3.612|
000194  6800              LDR      r0,[r0,#0]  ; x
000196  f0804000          EOR      r0,r0,#0x80000000
00019a  e001              B        |L3.416|
                  |L3.412|
00019c  4831              LDR      r0,|L3.612|
00019e  6800              LDR      r0,[r0,#0]  ; x
                  |L3.416|
0001a0  4604              MOV      r4,r0
0001a2  4938              LDR      r1,|L3.644|
0001a4  f7fffffe          BL       __aeabi_cfrcmple
0001a8  d202              BCS      |L3.432|
0001aa  2003              MOVS     r0,#3
0001ac  492f              LDR      r1,|L3.620|
0001ae  7188              STRB     r0,[r1,#6]
                  |L3.432|
;;;136    	}
;;;137    	
;;;138    	if(flag.calibratingM == 3 && (absu16(sensor.acc.averag.y) > 5000))   {
0001b0  482e              LDR      r0,|L3.620|
0001b2  7980              LDRB     r0,[r0,#6]  ; flag
0001b4  2803              CMP      r0,#3
0001b6  d14c              BNE      |L3.594|
0001b8  492d              LDR      r1,|L3.624|
0001ba  68c8              LDR      r0,[r1,#0xc]
0001bc  2100              MOVS     r1,#0
0001be  f7fffffe          BL       __aeabi_cfcmple
0001c2  d204              BCS      |L3.462|
0001c4  482a              LDR      r0,|L3.624|
0001c6  68c0              LDR      r0,[r0,#0xc]
0001c8  f0804000          EOR      r0,r0,#0x80000000
0001cc  e001              B        |L3.466|
                  |L3.462|
0001ce  4828              LDR      r0,|L3.624|
0001d0  68c0              LDR      r0,[r0,#0xc]
                  |L3.466|
0001d2  4604              MOV      r4,r0
0001d4  4927              LDR      r1,|L3.628|
0001d6  f7fffffe          BL       __aeabi_cfrcmple
0001da  d23a              BCS      |L3.594|
;;;139    	  y += sensor.gyro.radian.y * Gyro_G * 0.002f;
0001dc  4924              LDR      r1,|L3.624|
0001de  6e08              LDR      r0,[r1,#0x60]
0001e0  f7fffffe          BL       __aeabi_f2d
0001e4  4680              MOV      r8,r0
0001e6  4a24              LDR      r2,|L3.632|
0001e8  4b24              LDR      r3,|L3.636|
0001ea  f7fffffe          BL       __aeabi_dmul
0001ee  f04f4260          MOV      r2,#0xe0000000
0001f2  4b23              LDR      r3,|L3.640|
0001f4  e9cd0100          STRD     r0,r1,[sp,#0]
0001f8  f7fffffe          BL       __aeabi_dmul
0001fc  4604              MOV      r4,r0
0001fe  460d              MOV      r5,r1
000200  4817              LDR      r0,|L3.608|
000202  6800              LDR      r0,[r0,#0]  ; y
000204  f7fffffe          BL       __aeabi_f2d
000208  4682              MOV      r10,r0
00020a  4622              MOV      r2,r4
00020c  462b              MOV      r3,r5
00020e  f7fffffe          BL       __aeabi_dadd
000212  e9cd0102          STRD     r0,r1,[sp,#8]
000216  f7fffffe          BL       __aeabi_d2f
00021a  4911              LDR      r1,|L3.608|
00021c  6008              STR      r0,[r1,#0]  ; y
;;;140    		if(absFloat(y)>360)  {
00021e  2100              MOVS     r1,#0
000220  480f              LDR      r0,|L3.608|
000222  6800              LDR      r0,[r0,#0]  ; y
000224  f7fffffe          BL       __aeabi_cfcmple
000228  d204              BCS      |L3.564|
00022a  480d              LDR      r0,|L3.608|
00022c  6800              LDR      r0,[r0,#0]  ; y
00022e  f0804000          EOR      r0,r0,#0x80000000
000232  e001              B        |L3.568|
                  |L3.564|
000234  480a              LDR      r0,|L3.608|
000236  6800              LDR      r0,[r0,#0]  ; y
                  |L3.568|
000238  4604              MOV      r4,r0
00023a  4912              LDR      r1,|L3.644|
00023c  f7fffffe          BL       __aeabi_cfrcmple
000240  d207              BCS      |L3.594|
;;;141    			clen_flag = 1;
000242  2001              MOVS     r0,#1
000244  4904              LDR      r1,|L3.600|
000246  7008              STRB     r0,[r1,#0]
;;;142    			flag.calibratingM = 0;
000248  2000              MOVS     r0,#0
00024a  4908              LDR      r1,|L3.620|
00024c  7188              STRB     r0,[r1,#6]
;;;143    			EE_SAVE_MAG_OFFSET();
00024e  f7fffffe          BL       EE_SAVE_MAG_OFFSET
                  |L3.594|
;;;144    		}
;;;145    	}	
;;;146    }
000252  e8bd9fff          POP      {r0-r12,pc}
                          ENDP

000256  0000              DCW      0x0000
                  |L3.600|
                          DCD      clen_flag
                  |L3.604|
                          DCD      z
                  |L3.608|
                          DCD      y
                  |L3.612|
                          DCD      x
                  |L3.616|
                          DCD      mag_limt
                  |L3.620|
                          DCD      flag
                  |L3.624|
                          DCD      sensor
                  |L3.628|
                          DCD      0x459c4000
                  |L3.632|
                          DCD      0xc89d6830
                  |L3.636|
                          DCD      0x3f9f3ffe
                  |L3.640|
                          DCD      0x3f60624d
                  |L3.644|
                          DCD      0x43b40000

                          AREA ||.bss||, DATA, NOINIT, ALIGN=2

                  HMC58X3_limit
                          %        12
                  ||An||
                          %        12

                          AREA ||.data||, DATA, ALIGN=2

                  mag_limt
                          DCD      HMC58X3_limit
                  onc
000004  01                DCB      0x01
                  clen_flag
000005  010000            DCB      0x01,0x00,0x00
                  x
                          DCD      0x00000000
                  y
                          DCD      0x00000000
                  z
                          DCD      0x00000000
